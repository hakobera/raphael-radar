(function(){function p(b,c,d){for(var f=[],a=0;a<c.length;a++)f.push(""+(b.x+(c[a].x-b.x)*d[a].value)+" "+(b.y+(c[a].y-b.y)*d[a].value));return"M "+f.join("L ")+"L "+f[0]}function i(b,c,d,f,a,e,h,g,j){this.raphael=b;this.chart={};this.points=[];this.cx=c;this.cy=d;this.radius=f;this.bottom=0;this.min_score=e;this.max_score=h;this.labels=a;this.score_groups=g;this.user_draw_options=j;this.global_draw_defaults={text:{fill:"#222","max-chars":10,key:!0}};this.global_draw_options=$.extend(!0,this.global_draw_defaults,
j)}i.prototype.draw=function(){this.drawChartFrame();this.drawMeasures();this.drawScore();this.drawLable()};i.prototype.polygon=function(b){var c="M 100 100",d,f=b.length,a,e;for(d=0;d<f;++d)a=b[d].x,e=b[d].y,a=0==d?"M "+a+" "+e+" ":"L "+a+" "+e+" ",d===f-1&&(a+="L "+b[0].x+" "+b[0].y+" "),c+=a;return this.raphael.path(c)};i.prototype.drawChartFrame=function(){var b=this.labels.length,c=-90,d,f,a;for(d=this.bottom=0;d<b;d++)a=c/360*2*Math.PI,f=this.cx+this.radius*Math.cos(a),a=this.cy+this.radius*
Math.sin(a),this.points.push({x:f,y:a}),c+=360/b,a>this.bottom&&(this.bottom=a);this.chart.frame=this.polygon(this.points).attr({stroke:"#777"})};i.prototype.drawMeasures=function(){var b=this.points,c=[],d=[],f=[],a,e,h=b.length,g,j,i,l,o=(this.max_score-this.min_score)/5;for(a=0;a<h;++a){e=b[a].x;g=b[a].y;c.push(this.raphael.path("M "+this.cx+" "+this.cy+" L "+e+" "+g).attr("stroke","#777"));d[a]=[];for(e=0;5>=e;++e)if(g=this.cx+(b[a].x-this.cx)*(0.2*e-0.025),i=this.cy+(b[a].y-this.cy)*(0.2*e-0.025),
j=this.cx+(b[a].x-this.cx)*(0.2*e+0.025),l=this.cy+(b[a].y-this.cy)*(0.2*e+0.025),0!==e&&5!==e&&(j=this.raphael.path("M "+g+" "+i+" L "+j+" "+l).attr({stroke:"#777"}),j.rotate(90),d[a].push(j)),0===a)g=this.raphael.text(g-7,l,this.min_score+e*o).attr($.extend(!0,this.global_draw_options.text,{"text-anchor":"end"})),f.push(g)}this.chart.measures=c;this.chart.rulers=d;this.chart.ruler_text=f};i.prototype.drawScore=function(){var b,c,d,f,a,e,h,g,i={points:{fill:"#333","stroke-width":"0",size:4.5},text:{fill:"#222",
"text-anchor":"start"},lines:{"stroke-width":"1"}},q=this.score_groups.length,l=this.points,o={x:this.cx,y:this.cy},k=this.score_groups,m=this.labels;this.chart.scores=[];for(b=0;b<q;++b){a=[];var n={};e=[];g=$.extend(!0,i,k[b].draw_options);if(k[b].scores)for(c=0;c<k[b].scores.length;++c)a.push({value:(k[b].scores[c]-this.min_score)/(this.max_score-this.min_score),rawValue:k[b].scores[c],label:this.labels[c]});else for(c=0;c<m.length;++c)h=k[b][m[c]]||k[b][m[c].toLowerCase().replace(" ","_")],a.push({value:(h-
this.min_score)/(this.max_score-this.min_score),rawValue:h,label:m[c]});h=k[b].title;c=this.raphael.path(p(o,l,a)).attr(g.lines);n.line=c;for(c=0;c<a.length;c++)d=this.cx+(l[c].x-this.cx)*a[c].value,f=this.cy+(l[c].y-this.cy)*a[c].value,d=this.raphael.circle(d,f,g.points.size).attr(g.points),d.score=a[c],d.title=h,e.push(d);n.points=e;h&&this.global_draw_options.text.key&&(d=this.cx-50,f=this.bottom+40+20*b,a=this.cx,e=f,c=this.raphael.path("M "+d+" "+f+" L "+a+" "+e).attr(g.lines),d=this.raphael.circle(d,
f,g.points.size).attr(g.points),g=this.raphael.text(a+10,e,h).attr(g.text),n.title={line:c,point:d,text:g});this.chart.scores.push(n)}};i.prototype.drawLable=function(){var b=this.points,c=b.length,d,f,a,e,h;this.chart.labels=[];for(d=0;d<c;++d)h="middle",f=this.cx+1.1*(b[d].x-this.cx),a=this.cy+1.1*(b[d].y-this.cy),f>this.cx&&(h="start"),f<this.cx&&(h="end"),e=this.labels[d],e.length>this.global_draw_options.text["max-chars"]&&(e=e.replace(" ","\n")),f=this.raphael.text(f,a,e).attr($.extend(!0,this.global_draw_options.text,
{"text-anchor":h})),this.chart.labels.push(f)};Raphael.fn.radarchart=function(b,c,d,f,a,e,h,g){b=new i(this,b,c,d,f,a,e,h,g);b.draw();return b.chart}})();